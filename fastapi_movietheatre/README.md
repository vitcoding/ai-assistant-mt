# Поисковый сервис. 

## Описание.
Сервис предназначен для поиска информации по фильмам онлайн кинотеатра. Доступ к полной информации сервиса предоставляется авторизованным пользователям по access JWT токенам. Неавторизованные пользователи могут посмотреть постраничный список фильмов с коротким описанием (используется в качестве изящной деградации).

### Архитектурное решение:
- **серверная часть**: сервер на Fast API для обработки запросов пользователей по фильмам, жанрам и персонам;
- **поисковый движок**: ElasticSearch для поиска информации по фильмам;
- **etl**: python приложение для переноса данных по фильмам из базы данных PostgreSQL admin сервиса в ElasticSearch;
- **хранилище кешированных запросов**: Redis для кеширования запросов пользователей c ограниченным временем хранения данных;
- **эндпоинты /films/...**: для просмотра информации по фильму / фильмам, полнотекстового поиска по фильмам;
- **эндпоинты /genres/...**: для просмотра информации по жанру / жанрам;
- **эндпоинты /persons/...**: для просмотра информации по персоне / персонам, полнотекстового поиска по персонам;
- **эндпоинт /auth/login**: для получения access JWT токена (через данный эндпоинт поисковый сервис обращается к сервису авторизации за токеном);
- **документация OpenAPI**: встроенная автоматически генерируемая документация FastAPI на основе спецификаций OpenAPI.

### Основные роли, предполагаемые к использованию в сервисе:
- **admin, subscriber**: права роли 'user' + права на просмотр контента, созданного менее 3 лет назад;
- **user**: права на просмотр информации о контенте и права на просмотр контента, созданного более 3 лет назад;
- **unregestered-user**: права на просмотр постраничного списка фильмов с коротким описанием и на вход в систему.

### Тесты.
Сделаны тесты для проверки работоспособности всех эндпоинтов сервиса.

### Основные команды для запуска сервиса:
- **запуск сервиса в docker compose**: 
`docker compose -f docker-compose-mt.yml up -d`;
- **остановка сервиса**: 
`docker compose -f docker-compose-mt.yml down`;
- **запуск тестов**: 
`docker compose -f src/tests/functional/docker-compose.yml up -d`;
- **завершение тестов**: 
`docker compose -f src/tests/functional/docker-compose.yml down -v`.

Более подробно все основные команды представлены в [Makefile](Makefile).


[http://localhost:8000/api/openapi](http://localhost:8000/api/openapi)